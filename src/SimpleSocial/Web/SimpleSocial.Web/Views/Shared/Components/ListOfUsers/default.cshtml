@model SimpleSocia.Services.Models.Followers.UsersListViewModel

<script src="~/lib/jquery/dist/jquery.js"></script>

@if (!Model.Users.Any() && ViewData["Title"].ToString() != "MyProfile")
{
    <div class="text-center">
        <h3>
            <span>No @Model.NoUsersWord <i class="fas fa-user-times"></i></span>
            <div style="margin-top: 10px;">
                <a asp-controller="Followers" asp-action="WhoToFollow" class="no-followers-btn">Find Some</a>
            </div>
        </h3>
    </div>
}
else
{
    var users = Model.Users.ToList();
    if (ViewData["Title"].ToString() == "MyProfile")
    {
        users = users.Take(3).ToList();
    }
    foreach (var user in users)
    {     
        <div class="follower">
            <div class="left-user-section">
                <div class="profile-picture" style="background: url(@user.ProfilePicture.FileName); background-size: cover"></div>
                <div class="user-name"><a asp-controller="Profiles" asp-action="Index" asp-route-userId="@user.Id"><strong>@user.UserName</strong></a></div>
            </div>
            <div class="right-user-section">
                @if (user.IsFollowingCurrentUser)
                {
                    <button data-userid="@user.Id" class="unfollow">Unfollow</button>
                }
                else
                {
                    <button data-userid="@user.Id">Follow</button>
                }

            </div>
        </div>

    }

}

<script>
    var usersToFollow = document.querySelectorAll('.follower');

    usersToFollow.forEach(user => {
        user.querySelector('button').addEventListener('click', () => {
            var button = user.querySelector('button');
            var btnText = button.innerHTML.toLowerCase();
            var userId = button.dataset.userid;
            console.log(btnText);
            console.log(userId);
            
            $.ajax({
                type: "POST",
                url: "/Followers/ChooseAction",
                data: { userId: userId, action: btnText.toLowerCase() },
                success: function() {
                    console.log("successly send");
                },
                complete: function() {
                    if (btnText === "follow") {
                        $(button).addClass("unfollow").text("Unfollow");
                    } else if (btnText === "unfollow") {
                        $(button).removeClass("unfollow").text("Follow");
                    }
                }
            });
        });
    });
</script>