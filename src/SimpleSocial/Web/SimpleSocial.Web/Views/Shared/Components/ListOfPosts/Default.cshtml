@using SimpleSocial.Data.Models
@model SimpleSocia.Services.Models.Account.PostsFeedAndUserInfoViewModel


<script src="~/lib/jquery/dist/jquery.js"></script>
@{
    var counter = 0;
}


@foreach (var post in Model.Posts)
{

    counter++;
    var likeClassName = "like-ajax-" + counter;

    @await Component.InvokeAsync("SinglePost", new {
    currentUserId = Model.CurrentUserInfo.UserId ,
    post = post,
    likeClassName = likeClassName,
    profilePicture = Model.CurrentUserInfo.ProfilePicture,
    commentInputModel = Model.CommentInputModel })
}

<script>
    //check all posts like buttons
    var buttons = $(".like-btn");

    $(document).ready(function () {
        $.each(buttons,
            function () {
                var likebtn = $(this);
                var isLiked = likebtn.data("like");
                if (isLiked === 'True') {
                    likebtn.html("<i class=\"far fa-thumbs-down\"></i>Unlike");
                } else {
                    likebtn.html("<i class=\"far fa-thumbs-up\"></i>Like");
                }
            });
    });

</script>

<script>
    const posts = document.querySelectorAll('.single-post');    
    const modal = document.querySelector('.modal');
    const overlay = document.querySelector('.overlay');

    function toggleModal() {
        modal.classList.toggle('modal-show');
        overlay.classList.toggle('overlay-show');
    }

    posts.forEach(post => {
        post.querySelector('button').addEventListener('click', ()=> {
            const likes = post.querySelector('.likes');
            modal.querySelector('.body').innerHTML = likes.innerHTML;
            toggleModal();
        });
    });

    modal.querySelector('button').addEventListener('click', toggleModal);

    posts.forEach(post => {
        post.querySelector('.like-btn').addEventListener('click', ()=> {
            var likeBtn = post.querySelector('button.like-btn');   
            var dataLike = likeBtn.dataset.like.toLowerCase();
            var postId = likeBtn.dataset.postid;

            jQuery.ajax({
                type: "POST",
                url: "/Likes/GetAction",
                data: { isLiked: dataLike, postId: postId, userId : "@Model.CurrentUserInfo.UserId" },
                success: function () {
                    if (dataLike === 'true') {
                        likeBtn.dataset.like = 'false';
                    }  else {
                        likeBtn.dataset.like = 'true';                      
                    }   
                },
                complete: function () {
                    if (dataLike === 'true') {
                        likeBtn.innerHTML = "";
                        likeBtn.innerHTML = "<i class=\"far fa-thumbs-up\"></i>Like";
                    } else {
                        likeBtn.innerHTML = "";
                        likeBtn.innerHTML = "<i class=\"far fa-thumbs-down\"></i>Unlike";
                    }
                }
            });
        });
    });
</script>

