@model SimpleSocia.Services.Models.Account.PostsFeedAndUserInfoViewModel

@{
    ViewData["Title"] = "Index";
}

<div class="container">
    <div class="row">
        <div class="col-md-3">
            <partial name="~/Views/Shared/Partials/_UserInfoPartial.cshtml" for="UserProfileInfo" />
        </div>
        <div class="col-md-6">
            @if (Model.UserProfileInfo.IsBeingFollowedByCurrentUser)
            {
                @await Component.InvokeAsync("ListOfPosts", new { posts = Model })
            }          
        </div>
    </div>
</div>

@section Scripts{
    <script>
        var buttons = $(".like-btn");

        $(document).ready(function() {
            $.each(buttons,
                function() {
                    var likebtn = $(this);
                    var isLiked = likebtn.data("like");
                    if (isLiked === 'True') {
                        likebtn.html("<i class=\"far fa-thumbs-down\"></i>Unlike");
                    } else {
                        likebtn.html("<i class=\"far fa-thumbs-up\"></i>Like");
                    }
                });
        });
    </script>

    <script>
        $(".follow-btn").click(function() {
            var btnText = $(this).text().toLowerCase();
            console.log(btnText);
            $.ajax({
                type: "POST",
                url: "/Followers/ChooseAction",
                data: { userId: "@Model.UserProfileInfo.UserId", action: btnText.toLowerCase() },
                success: function() {
                    console.log("successly send");
                },
                complete: function() {
                    if (btnText === "follow") {
                        $(".follow-btn").addClass("unfollow").text("Unfollow");
                    } else if (btnText === "unfollow") {
                        $(".follow-btn").removeClass("unfollow").text("Follow");
                    }
                    location.reload();
                }
            });
        })
    </script>
}